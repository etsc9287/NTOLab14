---
title: "NTOLab14"
author: "NTO"
date: "4/23/2019"
output: html_document
---

```{r,echo = FALSE}

library(tidyverse)
library(lubridate)
library(stringr)
library(modelr)
options(na.action = na.warn)

babies <- read_csv("https://raw.githubusercontent.com/ervance1/Sp2018-Data-Science-repo/master/babies2a.dat")
babies <- rename(babies, bwtoz = `bwt/oz`)

```

****
### Overall questions and Importance: 
****

* "Do mothers' smoking habits affect the presence of premature births?" and "Do mothers' smoking habits affect the correlation between their babys' gestational age and birth weight?"

* These questions are important because answering them will allow us to provide recommendations to mothers on whether or not smoking is hurtful for their newborn babies.  Most parents care deeply about the well-being of their babies, who contain fragile health, making this statistical study very relevant and important. 

****
### Team Section
****

```{r,echo = FALSE}

```

* Findings and Recommendations:

* New Tools / Comparison with Lab 4: 

****
### David's Section
****

Subquestion and Importance: 

```{r,echo = FALSE}
dave1 <- babies %>% filter(!is.na(gestation))
ggplot(dave1,aes(bwtoz,gestation))+
  geom_point()

model1 <- function(a,data){
  a[1]+data* a[2]
    #linear model a +xb where x is data set
  # data is in form data$column
}

distance <- function(a,data){
  diff <- data - model1(a,data)
  abs(mean(diff))
    # data is in form data$column
    # finds distance
}
gest_dist <- function(a1,a2,data){
  distance(c(a1,a2),dave1$gestation)
}

models <- tibble(
  a1 = runif(2500, 200, 300),
  a2 = runif(2500, -2, 2)
)

models2 <- models %>% mutate(dist = purrr::map2_dbl(a1,a2,gest_dist))
models
models2
```
```{r}
#grid searchinig instead of random
grid <- expand.grid(
  a1 = seq(200,300, length =25),
  a2 = seq(-1,1,length = 25)
) %>% mutate(dist = purrr::map2_dbl(a1,a2,gest_dist))
grid
grid %>% ggplot(aes(a1,a2))+
  geom_point(data = filter(grid, rank(dist)<=10),color = "red",size = 4)+ 
  geom_point(aes(color = -dist))

ggplot(dave1,aes(bwtoz,gestation))+
  geom_point()+
  geom_abline(
    aes(intercept = a1, slope = a2, color = -dist),
    data = filter(grid, rank(dist) <= 10)
  )
doop <- dave1[,c(3:4)]
#best <- optim(c(0,0),distance, data = doop)
#best$par
## intial starting point in the c(0,0). finds the best slope to the data 

```
```{r}
mod3 <- lm(gestation~bwtoz, data = doop)
a <- coef(mod3)
a
```


```{r}
ggplot(data = dave1, aes(bwtoz,gestation))+
  geom_point(color = "grey15")+
  geom_abline(aes(intercept = a[1], slope = a[2]),color = "blue",size = 1.2)

grid <- doop %>% data_grid(bwtoz)
grid
grid <- grid %>% add_predictions(mod3)
grid
ggplot(doop, aes(bwtoz)) +
  geom_point(aes(y=gestation))+
  geom_line( aes( y = pred),data = grid)

```
```{r}
dope <- doop %>% add_residuals(mod3)
dope
ggplot(data = dope,aes(resid))+
  geom_freqpoly(binwidth = 1)

davie <- dave1[,c(3,4,18)] %>% filter(!is.na(smoke)) %>% mutate(smoke = str_replace_all(smoke, c("1" = "still smokes", "0" = "never")))
ggplot(davie,aes(bwtoz,gestation))+
  geom_point(aes(color = smoke))
```
```{r}
mod2 <- lm(gestation ~ bwtoz * smoke, data = davie)

bb <- coef(mod2)
bb
gridtry <- davie %>% 
  data_grid(bwtoz,smoke) %>% 
  gather_predictions(mod2)
gridtry

ggplot(davie, aes(bwtoz,gestation,colour = smoke)) + 
  geom_point() + 
  geom_line(data = gridtry, aes(y = pred))

residdiff <- davie %>% add_residuals(mod2)
residdiff

ggplot(data = residdiff,aes(resid,color = smoke))+
  geom_freqpoly(binwidth = 1)

```

New Tools: 

Findings / Relation to Team Section: 

****
### Ryan's Section
****

Subquestion and Importance: 

```{r,echo = FALSE}

```

New Tools: 

Findings / Relation to Team Section: 

****
### Ethan's Section
****

Subquestion and Importance: 

```{r,echo = FALSE}

```

New Tools: 

Findings / Relation to Team Section: 

****
### Arie's Section
****

Subquestion and Importance: 

```{r,echo = FALSE}

```

New Tools: 

Findings / Relation to Team Section: 

****
### Anderson's Section
****

Subquestion and Importance: 

```{r,echo = FALSE}

```

New Tools: 

Findings / Relation to Team Section: 

****
#### Who Did What
****

* David -
* Arie - 
* Anderson - 
* Ethan - 
* Ryan - 
